<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satori Eye Configuration</title>
    <style>
        :root {
            /* é…è‰²ç³»ç»Ÿ */
            --bg-color: #FDFDFD;
            --sidebar-width: 240px;
            --text-main: #333333;
            --text-sub: #888888;

            --card-bg: #FCEEF5;
            --accent-color: #6D5063;
            --switch-off: #DDD;
            --btn-pill-bg: #FFF0F6;
            --btn-pill-hover: #EAD0DC;

            --shadow-card: 0 8px 30px rgba(109, 80, 99, 0.08);
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            margin: 0; padding: 0;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* === ä¾§è¾¹æ  === */
        .sidebar {
            width: var(--sidebar-width);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #F5F5F5;
            background: #FAFAFA;
        }
        .brand {
            font-size: 20px; font-weight: 800; color: var(--accent-color);
            margin-bottom: 40px; display: flex; align-items: center; gap: 10px;
        }
        .menu-group { margin-bottom: 25px; }
        .menu-title { font-size: 12px; color: var(--text-sub); margin-bottom: 10px; padding-left: 10px; font-weight: 600; }
        .menu-item {
            display: flex; align-items: center; padding: 12px 15px;
            border-radius: 10px; color: var(--text-main); cursor: pointer;
            transition: 0.2s; font-size: 14px; font-weight: 500;
        }
        .menu-item.active { background-color: #FFF0F6; color: #E91E63; font-weight: 600; }
        .menu-item:hover:not(.active) { background-color: #F0F0F0; }

        /* === ä¸»å†…å®¹åŒº === */
        .main-content {
            flex: 1; padding: 30px 50px;
            overflow-y: auto; display: flex; flex-direction: column; align-items: center;
            justify-content: center;
        }

        /* === æ ¸å¿ƒå¡ç‰‡ === */
        .device-stage {
            background-color: var(--card-bg);
            width: 100%; max-width: 860px;
            border-radius: 24px;
            padding: 30px 40px;
            display: flex; flex-direction: column; align-items: center;
            box-shadow: var(--shadow-card);
            position: relative;
            transition: all 0.3s ease;
        }

        /* === å‚ç›´ç¼©æ”¾æ»‘æ¡å®¹å™¨ === */
        .zoom-side-panel {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-55%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 50px;
            z-index: 5;
        }

        /* æ–‡å­—æ ·å¼ */
        .zoom-label-top, .zoom-label-bottom {
            font-size: 12px;
            font-weight: 700;
            color: var(--accent-color);
            opacity: 0.6;
            text-align: center;
            margin: 0;
            /* ç§»é™¤äº† writing-mode */
        }

        /* é¡¶éƒ¨æ–‡å­—ç»™ç‚¹ä¸‹è¾¹è·ï¼Œé˜²æ­¢è´´ç€æ»‘æ¡ */
        .zoom-label-top { margin-bottom: 10px; }

        /* åº•éƒ¨æ–‡å­—ç»™ç‚¹ä¸Šè¾¹è· */
        .zoom-label-bottom { margin-top: 10px; }

        /* è‡ªå®šä¹‰å‚ç›´æ»‘æ¡ */
        input[type=range].vertical-range {
            -webkit-appearance: none;
            width: 180px; /* æ»‘æ¡ç‰©ç†é•¿åº¦ */
            height: 6px;  /* è½¨é“ç²—ç»† */
            background: transparent;

            /* æ—‹è½¬ -90åº¦ */
            transform: rotate(-90deg);
            /* ç”¨ margin æ’‘å¼€æ—‹è½¬åçš„ä¸Šä¸‹ç©ºé—´ï¼Œé˜²æ­¢è¦†ç›–æ–‡å­— */
            margin: 80px 0;
        }

        input[type=range].vertical-range::-webkit-slider-runnable-track {
            width: 100%; height: 6px; cursor: pointer;
            background: rgba(109, 80, 99, 0.2); border-radius: 3px;
        }

        input[type=range].vertical-range::-webkit-slider-thumb {
            height: 18px; width: 18px; border-radius: 50%;
            background: var(--accent-color); cursor: pointer;
            -webkit-appearance: none;
            margin-top: -6px;
            box-shadow: 0 2px 6px rgba(109,80,99,0.4);
            transition: transform 0.1s;
        }

        input[type=range].vertical-range:active::-webkit-slider-thumb { transform: scale(1.2); }


        /* === æ‘„åƒå¤´ç”»é¢å®¹å™¨ === */
        .camera-frame-wrapper {
            width: 100%;
            height: 480px;
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 20px;
            margin-top: 10px;
            background-image: radial-gradient(#6D506320 1px, transparent 1px);
            background-size: 20px 20px;
            border-radius: 16px;
            padding-right: 40px;
        }

        #stream {
            width: 240px;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            image-rendering: pixelated;
            transition: width 0.1s;
            border: 4px solid #FFF;
        }

        /* === åº•éƒ¨æ§åˆ¶é¢æ¿ === */
        .control-panel {
            width: 100%;
            display: flex; justify-content: space-between; align-items: flex-end;
            padding-top: 20px;
            padding-right: 40px;
            border-top: 2px dashed rgba(109,80,99,0.1);
        }

        .switch-group { display: flex; gap: 30px; }
        .switch-item { display: flex; flex-direction: column; gap: 8px; }
        .switch-label { font-size: 12px; color: var(--accent-color); font-weight: 700; }

        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--switch-off); transition: .3s; border-radius: 26px;
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px;
            background-color: white; transition: .3s; border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(24px); }

        .action-group { display: flex; gap: 12px; }
        .btn-pill-small {
            background-color: #FFF; border: 1px solid rgba(109,80,99,0.15); color: var(--accent-color);
            padding: 8px 20px; border-radius: 20px; font-size: 13px; font-weight: 600;
            cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.02); transition: all 0.2s;
            display: flex; align-items: center; gap: 6px;
        }
        .btn-pill-small:hover { background-color: var(--accent-color); color: white; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(109,80,99,0.2); }
        .btn-pill-small:active { transform: translateY(0); }

        .ota-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(252, 238, 245, 0.95); border-radius: 24px; display: none;
            flex-direction: column; justify-content: center; align-items: center; z-index: 10;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand"><span>ğŸ‘ï¸</span> SATORI DEVICE</div>
        <div class="menu-group">
            <div class="menu-title">è®¾ç½®</div>
            <div class="menu-item active">ğŸ“· å®æ—¶é¢„è§ˆ</div>
            <div class="menu-item">ğŸ§  æ¨¡å‹é…ç½®</div>
            <div class="menu-item">âš™ï¸ ç³»ç»Ÿé€‰é¡¹</div>
        </div>
        <div class="menu-group">
            <div class="menu-title">èµ„æº</div>
            <div class="menu-item" onclick="document.getElementById('fw_file').click()">ğŸš€ å›ºä»¶å‡çº§</div>
            <input type="file" id="fw_file" accept=".bin" style="display: none;" onchange="startOTA()">
        </div>
    </div>

    <div class="main-content">
        <div class="device-stage">

            <div class="zoom-side-panel">
                <span class="zoom-label-top">ZOOM</span>
                <input type="range" class="vertical-range" min="100" max="300" value="100" id="zoomSlider" oninput="updateZoom(this.value)">
                <span class="zoom-label-bottom" id="zoomValue">100%</span>
            </div>

            <div class="camera-frame-wrapper">
                <img id="stream" src="/stream" alt="Stream Loading...">
            </div>

            <div class="control-panel">
                <div class="switch-group">
                    <div class="switch-item">
                        <span class="switch-label">å¯ç”¨ AI æ¨ç†</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="aiToggle" onchange="toggleAI(this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="switch-item">
                        <span class="switch-label">Web ä¼˜å…ˆ</span>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="action-group">
                    <button class="btn-pill-small" onclick="snapshot()">
                        <span>ğŸ“·</span> æŠ“æ‹
                    </button>
                    <button class="btn-pill-small" onclick="switchModel()">
                        <span>ğŸ”„</span> åˆ‡æ¢æ¨¡å‹
                    </button>
                    <button class="btn-pill-small" onclick="location.reload()">
                        <span>ğŸ”ƒ</span> åˆ·æ–°
                    </button>
                </div>
            </div>

            <div id="ota-status" class="ota-overlay">
                <h3 style="color: var(--accent-color);">Firmware Updating... <span id="progress-text">0%</span></h3>
                <div style="width: 300px; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden; margin-top: 10px;">
                    <div id="progress-bar" style="width: 0%; height: 100%; background: var(--accent-color); transition: width 0.2s;"></div>
                </div>
                <p style="font-size: 12px; color: #888; margin-top: 10px;">è¯·å‹¿æ–­å¼€ç”µæº</p>
            </div>

        </div>
    </div>

    <script>
        function updateZoom(val) {
            const img = document.getElementById('stream');
            const newWidth = 240 * (val / 100);
            img.style.width = newWidth + 'px';
            document.getElementById('zoomValue').innerText = val + '%';
        }

        function startOTA() {
            var fileInput = document.getElementById('fw_file');
            var file = fileInput.files[0];
            if (!file) return;
            if(!confirm("ç¡®è®¤åˆ·å…¥: " + file.name + " ?")) return;

            document.getElementById('ota-status').style.display = 'flex';

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/update", true);
            xhr.upload.onprogress = function(e) {
                if (e.lengthComputable) {
                    var percent = (e.loaded / e.total) * 100;
                    document.getElementById('progress-bar').style.width = percent + "%";
                    document.getElementById('progress-text').innerText = percent.toFixed(0) + "%";
                }
            };
            xhr.onload = function() {
                if (xhr.status == 200) {
                    alert("å‡çº§æˆåŠŸï¼æ­£åœ¨é‡å¯...");
                    location.reload();
                } else {
                    alert("å¤±è´¥: " + xhr.status);
                    document.getElementById('ota-status').style.display = 'none';
                }
            };
            xhr.send(file);
        }

        function toggleAI(checkbox) { console.log("AI State:", checkbox.checked); }
        function snapshot() { console.log("Snapshot click"); }
        function switchModel() { console.log("Switch model click"); }
    </script>
</body>
</html>